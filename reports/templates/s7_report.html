<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>IndustrialScanner-Lite | S7Comm Analysis Report</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; color: #222; }
    h1 { margin-bottom: 4px; }
    .meta { color: #555; margin-bottom: 16px; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
    th { background: #f4f4f4; text-align: left; }
    .warn { color: #e65100; font-weight: bold; }
    .bad { color: #c62828; font-weight: bold; }
  </style>
</head>
<body>
  <h1>S7Comm Analysis Report</h1>
  <div class="meta">
    <div><strong>Generated:</strong> {{ report.meta.generated_at }}</div>
    <div><strong>PCAP File:</strong> {{ report.meta.pcap_file }}</div>
  </div>

  <h2>Summary</h2>
  <table>
    <tr>
      <th>Total Packets</th>
      <th>S7 Packets</th>
      <th>Suspect Functions</th>
      <th>Unique Hosts</th>
    </tr>
    <tr>
      <td>{{ report.summary.total_packets }}</td>
      <td>{{ report.summary.s7_packets }}</td>
      <td>{{ report.summary.suspect_functions }}</td>
      <td>{{ report.summary.unique_hosts | join(', ') }}</td>
    </tr>
  </table>

  <h2>Per-Packet Details</h2>
  <table>
    <tr>
      <th>Source</th>
      <th>Destination</th>
      <th>Function</th>
      <th>Length</th>
      <th>Hints</th>
    </tr>
    {% for r in report.results %}
    <tr>
      <td>{{ r.src }}</td>
      <td>{{ r.dst }}</td>
      <td>
        {% if r.function_code in ["WriteVar","Start","Stop","DownloadBlock","CopyRamToRom","FirmwareUpdate"] %}
          <span class="bad">{{ r.function_code }}</span>
        {% else %}
          {{ r.function_code }}
        {% endif %}
      </td>
      <td>{{ r.length }}</td>
      <td>{{ r.hints | join(', ') }}</td>
    </tr>
    {% endfor %}
  </table>

  <h2>Notes</h2>
  <ul>
    <li>This analysis is passive and read-only.</li>
    <li>Suspect functions (Start, Stop, WriteVar, DownloadBlock, CopyRamToRom, FirmwareUpdate) may indicate unauthorized control attempts or engineering operations.</li>
    <li>Packet parsing is simplified; deeper analysis can be added later.</li>
  </ul>
</body>
</html>
